[tools]
npm = "latest"
rust = "latest"

# =============================================================================
# Web Build Tasks
# =============================================================================

[tasks."build:emu:wasm"]
description = "Build Rust code to WebAssembly"
dir = "emu"
run = "wasm-pack build --target web --out-dir ../web/dist/pkg --features wasm --no-default-features"

[tasks."build:rom"]
description = "Build ROM for WASM to run"
dir = "rom"
depends_post = ["build:emu:wasm"]
run = "cargo run -- --release"

[tasks."build:debug"]
description = "Bundle the full debug js project"
dir = "web"
run = "node esbuild.config.js"
depends = ["build:emu:wasm", "build:rom"]

[tasks.dev]
description = "Build and serve the web project"
depends = ["build:debug"]
dir = "web/dist"
run = "npx serve ."

# =============================================================================
# Combined Build Tasks
# =============================================================================

[tasks.build]
description = "Build all targets (web)"
depends = ["build:debug"]

[tasks."build:all"]
description = "Build all targets (web + iOS)"
depends = ["build:debug", "build:ios"]

# =============================================================================
# Testing & Development
# =============================================================================

[tasks."test:emu"]
description = "Run all tests for emu"
dir = "emu"
run = "cargo test"

[tasks."test:rom"]
description = "Run all tests for rom"
dir = "rom"
run = "cargo test"

[tasks.test]
description = "Run all tests"
depends = ["test:emu", "test:rom"]

[tasks."check:emu"]
description = "Run cargo check and clippy for emu"
dir = "emu"
run = "cargo check && cargo clippy -- -D warnings"

[tasks."check:rom"]
description = "Run cargo check and clippy for rom"
dir = "rom"
run = "cargo check && cargo clippy -- -D warnings"

[tasks.check]
description = "Run cargo check and clippy"
dir = "emu"
run = "cargo check && cargo clippy -- -D warnings"

[tasks."fmt:emu"]
description = "Format code"
dir = "emu"
run = "cargo fmt"

[tasks."fmt:rom"]
description = "Format code"
dir = "rom"
run = "cargo fmt"

[tasks.fmt]
description = "Format code"
depends = ["fmt:emu", "fmt:rom"]

# =============================================================================
# Cleanup
# =============================================================================

[tasks.clean]
description = "Remove build artifacts"
run = "./scripts/clean.sh"

# =============================================================================
# iOS Build Tasks
# =============================================================================

[tasks."build:ios"]
description = "Build Rust static library for iOS (device + simulator)"
run = "./scripts/build-ios.sh release"

[tasks."build:ios:debug"]
description = "Build Rust static library for iOS (debug mode)"
run = "./scripts/build-ios.sh debug"

[tasks."build:emu:ios"]
description = "Build Rust static library for iOS device only"
dir = "emu"
run = "cargo build --target aarch64-apple-ios --features ios --no-default-features --release"

[tasks."build:emu:ios-sim"]
description = "Build Rust static library for iOS simulator only"
dir = "emu"
run = "cargo build --target aarch64-apple-ios-sim --features ios --no-default-features --release"

[tasks."xcode:open"]
description = "Open iOS project in Xcode"
run = "open ios/gb-ios.xcodeproj"
